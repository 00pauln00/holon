- name: "nisd_initialization_and_startup"
  hosts: localhost
  connection: local
  vars:
    recipe_name: "nisd_initialization_and_startup"
    parent: None
    number_of_clients: 2
    nisd_root_keys:
              - "/nisd_root_entry/0/uuid"
              - "/nisd_root_entry/0/instance-uuid"
              - "/nisd_root_entry/0/status"
              - "/nisd_root_entry/0/num-reserved-pblks"
              - "/nisd_root_entry/0/num-pblks"
              - "/nisd_root_entry/0/num-pblks-used"
              - "/nisd_root_entry/0/vblks-written"
              - "/nisd_root_entry/0/vblks-written"
              - "/nisd_root_entry/0/num-pblks-used"
              - "/nisd_root_entry/0/num-reserved-pblks-used"
    nisd_chunk_keys:
              - "/nisd_chunks/0/vdev-uuid"
              - "/nisd_chunks/0/number"
              - "/nisd_chunks/0/num-data-pblks"
              - "/nisd_chunks/0/num-meta-pblks"
              - "/nisd_chunks/0/num-reserved-meta-pblks"
              - "/nisd_chunks/0/metablock-seqno"
              - "/nisd_chunks/0/read-op-seqno"
              - "/nisd_chunks/0/merge-read-op-seqno"
              - "/nisd_chunks/0/vblks-read"
              - "/nisd_chunks/0/num-cme"
              - "/nisd_chunks/0/ref-cnt"
              - "/nisd_chunks/0/chunk-merge-cnt"
              - "/nisd_chunks/0/chunk-merge-status"

  tasks:
  - block:
      # Check for the app_type
     - name: "{{ recipe_name }}: Check if the app_type is 'controlplane'."
       vars:
         app_type: "{{ app_type }}"
       debug:
         msg: "app_type is: {{ app_type }}"
       failed_when:
         (app_type != "controlplane")

     - name: "{{ recipe_name }}: get the list of non-running servers."
       include_role:
          name: common
          tasks_from: get_server_uuid_info

     # Get multiple client uuids using common task.
     - name: "Get multiple client uuids."
       include_role:
        name: common
        tasks_from: get_multiple_client_uuids
       loop: "{{ range(0, number_of_clients) | list }}"

     - name: "Prepare gossip node configs"
       debug:
         msg: "{{lookup('niova_raftconfig', 'controlplane', TotalNServersList, ClientUUIDS, wantlist=True)}}"

      # Start 5 PMDB servers.
     - name: "{{ recipe_name }}: Start 5 pmdb servers in the cluster."
       include_role:
         name: common
         tasks_from: start_server_golang
       vars:
         ServerUUID: "{{ NonRunningServers[item] }}"
       loop: "{{ range(0, NonRunningServers | length) | list }}"

      #Start 1 proxy servers
     - name: "{{ recipe_name }}: Start 1 proxy servers."
       include_role:
          name: common
          tasks_from: start_proxy_server
       vars:
          ClientUUID: "{{ ClientUUIDS[item] }}"
       loop: "{{ range(0, ClientUUIDS | length) |list }}"

     - name: generate new lookout-uuid
       shell: uuidgen
       register: lookoutUUID

     - name: "{{ recipe_name }}: Start niova-lookout process."
       vars:
         input_param: {
                 'lookout_uuid' :  '{{ lookoutUUID["stdout_lines"][0] }}',
                 'aport' : '3900',
                 'hport' : '8001',
                 'rport' : '3901',
                 'uport' : '1053'
                 }
       debug:
         msg: "{{ lookup('controlplane', 'niova-lookout', input_param, wantlist=true) }}"
       no_log: True

     - pause:
         seconds: 5

     - name: "{{ recipe_name }}: Wait until lookout's status gets changed."
       vars:
         getLookoutUUID: "{{ lookoutUUID['stdout_lines'][0] }}"
         input_param: {
                  'Operation': 'membership',
                  'OutfileName': 'lookoutMembership'
                  }
       debug:
         msg: "Verifying lookout's Status"
       until: lookup('controlplane', 'ncpc', input_param, wantlist=True) | dict2items | map(attribute='value') | map(attribute=getLookoutUUID) | map(attribute='Status') | list | first == "alive"
       retries: 10
       delay: 1

     - name: generate new uuid
       shell: "/usr/bin/uuid"
       register: nisdUUID

     - debug:
         msg:
          - "Lookout UUID: {{ lookoutUUID['stdout_lines'][0] }}"
          - "Nisd UUID: {{ nisdUUID.stdout }}"

     - name: "{{ recipe_name }}: Start niova-block-ctl process."
       vars:
          input_param: {
             'nisd_uuid': '{{ nisdUUID.stdout }}',
             'nisd_dev_size': '68719476736',
             'lookout_uuid' :  '{{ lookoutUUID["stdout_lines"][0] }}'
              }
       debug:
         msg: "{{ lookup('controlplane', 'niova-block-ctl', input_param, wantlist=True) }}"
       no_log: True

     - name: "{{ recipe_name }}: Start nisd process."
       vars:
         input_param: {
                  'nisd_uuid' : '{{ nisdUUID.stdout }}',
                  'uport' : '1053',
                  'lookout_uuid' :  '{{ lookoutUUID["stdout_lines"][0] }}'
                  }
       debug:
         msg: "{{ lookup('controlplane', 'nisd', input_param, wantlist=True) }}"
       no_log: True

     - pause:
         seconds: 2

     - name: "{{ recipe_name }}: Wait until Nisd's status gets updated."
       vars:
         getNisd: "{{ nisdUUID.stdout }}"
         input_param: {
                  'Operation': 'NISDGossip',
                  'OutfileName': 'wait_for_nisdGossip'
                  }
       debug:
         msg: "Verifying NISD's Status"
       until: lookup('controlplane', 'ncpc', input_param, wantlist=True) | dict2items | map(attribute='value') | map(attribute=getNisd) | map(attribute='Status') | list | first == "Alive"
       retries: 10
       delay: 1

     - name: "{{ recipe_name}}: Wait until nisd_root_entry gets updated"
       vars:
         stage: "wait_for_nisd_root_entry"
         process_type: "nisd"
         lookout_uuid: "{{ lookoutUUID['stdout_lines'][0] }}"
       debug:
         msg: "Waiting for nisd to get updated"
       until: lookup('niova_ctlrequest', 'lookup', nisdUUID.stdout, '/nisd_root_entry/0/status', 'nisd', lookout_uuid, wantlist=True) | dict2items | map(attribute='value') | list | first == "running"
       retries: 10
       delay: 1

     - name: "{{ recipe_name }}: Get nisd_root_entry info."
       vars:
         stage: "get_nisd_root_entry"
         process_type: "nisd"
         lookout_uuid: "{{ lookoutUUID['stdout_lines'][0] }}"
         nisdRootEntryVal: "{{ lookup('niova_ctlrequest', 'lookup', nisdUUID.stdout, nisd_root_keys, 'nisd', lookout_uuid, wantlist=True) }}"
       debug:
         msg: "Get nisd root entry values"
       with_items:
        - "{{ nisdRootEntryVal }}"
       register: getNisdVal

     - name: "{{ recipe_name }}: prepare path to read recipe JSON file."
       shell: cat "{{base_dir}}"/"{{raft_uuid}}".json
       register: result

     - name: "{{ recipe_name }}: Convert output to JSON format."
       set_fact:
         getRaftProcessDetails: "{{ result.stdout | from_json }}"

     - name: "{{ recipe_name }}: Get the IMG_FILE_NAME."
       set_fact:
         getDeviceFile: "{{ getRaftProcessDetails | json_query(jmesquery) }}"
       vars:
         jmesquery: 'raft_process."{{ nisdUUID.stdout }}".img_file_name'

     - name: "{{ recipe_name }}: Verify nisd_root_entry info."
       vars:
         verifyNisd: "{{ getNisdVal['results'][0]['item'] }}"
       debug:
         msg: "verify nisd root entry values: {{ verifyNisd }}"
       no_log: True
       failed_when: >
         (verifyNisd['/0/uuid'] != nisdUUID.stdout) or
         (verifyNisd['/0/status'] != "running")

     - name: "{{ recipe_name }}: Get niorq_mgr_root_entry info."
       vars:
         stage: "get_nisd_root_entry"
         verifyNisd: "{{ getNisdVal['results'][0]['item']['/0/num-reserved-pblks'] }}"
         nisd_keys:
              - "/niorq_mgr_root_entry/0/uuid"
              - "/niorq_mgr_root_entry/0/dev-path"
              - "/niorq_mgr_root_entry/0/status"
              - "/niorq_mgr_root_entry/0/dev-bytes-read"
              - "/niorq_mgr_root_entry/0/dev-rd-size"
         process_type: "nisd"
         lookout_uuid: "{{ lookoutUUID['stdout_lines'][0] }}"
         niorq_mgr_entry: "{{ lookup('niova_ctlrequest', 'lookup', nisdUUID.stdout, nisd_keys, 'nisd', lookout_uuid, wantlist=True) }}"
       debug:
         msg: "Verify niorq_mgr_root_entry info: {{ niorq_mgr_entry }}"
       no_log: True
       failed_when: >
         (niorq_mgr_entry['/0/uuid'] != nisdUUID.stdout) or
         (niorq_mgr_entry['/0/status'] != "running") or
         (niorq_mgr_entry['/0/dev-path'] != getDeviceFile) or
         (niorq_mgr_entry['/0/dev-rd-size']['512'] != 3) or
         (niorq_mgr_entry['/0/dev-rd-size']['4096'] != (verifyNisd | int)) or
         (niorq_mgr_entry['/0/dev-bytes-read'] != ((verifyNisd | int) * 4096) + (3 * 512))

     - name: "Verify 'tasks' items are idle."
       include_role:
         name: common
         tasks_from: verify_nisd_tasks_parameters
       vars:
         NisdUUID: "{{ nisdUUID.stdout }}"
         LookoutUUID: "{{ lookoutUUID['stdout_lines'][0] }}"

     - name: "{{ recipe_name }}: Kill the nisd process."
       debug:
         msg:  "{{ lookup('niova_raftprocess', 'kill', nisdUUID.stdout, wantlist=True) }}"
       no_log: True

     - pause:
        seconds: 2

     - name: "{{ recipe_name }}: Wait until killed nisd's status gets changed."
       vars:
         getNisd: "{{ nisdUUID.stdout }}"
         input_param: {
                  'Operation': 'NISDGossip',
                  'OutfileName': 'wait_for_killed_nisdStatus'
                  }
       debug:
         msg: "Verifying NISD's Status"
       until: lookup('controlplane', 'ncpc', input_param, wantlist=True) | dict2items | map(attribute='value') | map(attribute=getNisd) | map(attribute='Status') | list | first == "Dead"
       retries: 10
       delay: 1

     - name: "{{ recipe_name }}: Restart same nisd process."
       vars:
          input_param: {
                  'nisd_uuid' : '{{ nisdUUID.stdout }}',
                  'uport' : '1053',
                  'lookout_uuid' :  '{{ lookoutUUID["stdout_lines"][0] }}'
                  }
       debug:
         msg: "{{ lookup('controlplane', 'nisd', input_param, wantlist=True) }}"
       no_log: True

     - pause:
         seconds: 2

     - name: "{{ recipe_name }}: Wait until restarted nisd's status gets changed."
       vars:
         getNisd: "{{ nisdUUID.stdout }}"
         input_param: {
                  'Operation': 'NISDGossip',
                  'OutfileName': 'restarted_nisdGossip'
                  }
       debug:
         msg: "Verifying NISD's Status"
       until: lookup('controlplane', 'ncpc', input_param, wantlist=True) | dict2items | map(attribute='value') | map(attribute=getNisd) | map(attribute='Status') | list | first == "Alive"
       retries: 20
       delay: 1

     - name: "{{ recipe_name}}: Wait until nisd_root_entry gets updated"
       vars:
         stage: "wait_for_nisd_root_entry"
         process_type: "nisd"
         lookout_uuid: "{{ lookoutUUID['stdout_lines'][0] }}"
       debug:
         msg: "Waiting for nisd to get updated"
       until: lookup('niova_ctlrequest', 'lookup', nisdUUID.stdout, "/nisd_root_entry/0/status", 'nisd', lookout_uuid, wantlist=True) | dict2items | map(attribute='value') | list | first == "running"
       retries: 10
       delay: 1

     - name: "{{ recipe_name }}: Get nisd_root_entry info."
       vars:
         stage: "afterRestart_nisd_root_entry"
         process_type: "nisd"
         lookout_uuid: "{{ lookoutUUID['stdout_lines'][0] }}"
         nisdRootEntryVal: "{{ lookup('niova_ctlrequest', 'lookup', nisdUUID.stdout, nisd_root_keys, 'nisd', lookout_uuid, wantlist=True) }}"
       debug:
         msg: "Get nisd root entry values"
       no_log: True
       with_items:
        - "{{ nisdRootEntryVal }}"
       register: aftrRestartNisd

     - name: "{{ recipe_name }}: Verify nisd_root_entry info."
       vars:
         prev_instance_uuid: "{{ getNisdVal['results'][0]['item'] }}"
         verifyNisd: "{{ aftrRestartNisd['results'][0]['item'] }}"
       debug:
         msg: "verify nisd root entry values"
       no_log: True
       failed_when: >
         (verifyNisd['/0/uuid'] != nisdUUID.stdout) or
         (verifyNisd['/0/status'] != "running") or
         (verifyNisd['/0/instance-uuid'] == prev_instance_uuid['/0/instance-uuid'])

     - name: Generate new vdev-uuid
       shell: "/usr/bin/uuid"
       register: vdevUUID

     - name: Generate new client-uuid for niova-block-test
       shell: "/usr/bin/uuid"
       register: blockTestClientUUID

     - name: "{{ recipe_name }}: Perform some Writes to the NISD."
       vars:
         input_param: {
                 'uuid_to_write' : 'unix:{{ nisdUUID.stdout }}',
                 'vdev' : '{{ vdevUUID.stdout }}',
                 'read_operation_ratio_percentage' : '0',
                 'random_seed' : '123',
                 'client_uuid' : '{{ blockTestClientUUID.stdout }}',
                 'request_size_in_bytes' : '32',
                 'queue_depth' : '1',
                 'num_ops' : '50',
                 'lookout_uuid' :  '{{ lookoutUUID["stdout_lines"][0] }}',
                 'integrity_check' : True,
                 'sequential_writes' : False
                 }
         wr_success: "{{ lookup('controlplane', 'niova-block-test', input_param, wantlist=True) }}"
       debug:
         msg: "get write's return code"
       no_log:  True
       with_items:
        - "{{ wr_success }}"
       register: get_wr

     - debug:
         msg: "Verify write is success"
       failed_when: (get_wr['results'][0]['item'] != "0")

     - name: "{{ recipe_name}}: Wait until nisd_root_entry gets updated"
       vars:
         stage: "wait_for_nisd_root_entry"
         process_type: "nisd"
         lookout_uuid: "{{ lookoutUUID['stdout_lines'][0] }}"
       debug:
         msg: "Waiting for nisd to get updated"
       no_log: True
       until: lookup('niova_ctlrequest', 'lookup', nisdUUID.stdout, "/nisd_root_entry/0/status", 'nisd', lookout_uuid, wantlist=True) | dict2items | map(attribute='value') | list | first == "running"
       retries: 10
       delay: 1

     - name: "{{ recipe_name }}: Get nisd_chunk info."
       vars:
         stage: "get_nisd_chunk"
         old_num_block_used: "{{ aftrRestartNisd['results'][0]['item']['/0/num-pblks-used'] }}"
         nisd_keys:
              - "/nisd_root_entry/0/vblks-written"
              - "/nisd_root_entry/0/num-pblks-used"
              - "/nisd_root_entry/0/num-reserved-pblks-used"
              - "/nisd_chunks/0/vdev-uuid"
              - "/nisd_chunks/0/num-data-pblks"
              - "/nisd_chunks/0/num-meta-pblks"
              - "/nisd_chunks/0/num-reserved-meta-pblks"
         process_type: "nisd"
         lookout_uuid: "{{ lookoutUUID['stdout_lines'][0] }}"
         getNiovaBlockTest: "{{ lookup('niova_ctlrequest', 'lookup', nisdUUID.stdout, nisd_keys, 'nisd', lookout_uuid, wantlist=True) }}"
       debug:
         msg: "Verify nisd values after writes: {{ getNiovaBlockTest }}"
       no_log: True
       failed_when: >
         (getNiovaBlockTest['/0/num-pblks-used'] != ((old_num_block_used | int) + 50)) or
         (getNiovaBlockTest['/0/vblks-written'] != 1600) or
         (getNiovaBlockTest['/0/num-reserved-pblks-used'] != 1) or
         (getNiovaBlockTest['/0/vdev-uuid'] != vdevUUID.stdout) or
         (getNiovaBlockTest['/0/num-data-pblks'] != 50) or
         (getNiovaBlockTest['/0/num-meta-pblks'] != 0) or
         (getNiovaBlockTest['/0/num-reserved-meta-pblks'] != 1)

     - name: "{{ recipe_name }}: Store the metablock-seqno."
       vars:
         stage: "get_metablock_seqno"
         process_type: "nisd"
         lookout_uuid: "{{ lookoutUUID['stdout_lines'][0] }}"
         getMetablockSeqNo: "{{ lookup('niova_ctlrequest', 'lookup', nisdUUID.stdout, '/nisd_chunks/0/metablock-seqno', 'nisd', lookout_uuid, wantlist=True) }}"
       debug:
         msg: "Get metablock-seqno"
       with_items:
        - "{{ getMetablockSeqNo }}"
       register: oldMetablockSeqNo

     - name: "{{ recipe_name }}: Kill the nisd process."
       debug:
         msg:  "{{ lookup('niova_raftprocess', 'kill', nisdUUID.stdout, wantlist=True) }}"
       no_log: True

     - pause:
        seconds: 2

     - name: "{{ recipe_name }}: Wait until killed nisd's status gets changed."
       vars:
         getNisd: "{{ nisdUUID.stdout }}"
         input_param: {
                  'Operation': 'NISDGossip',
                  'OutfileName': 'wait_for_killed_nisdStatus'
                  }
       debug:
         msg: "Verifying NISD's Status"
       until: lookup('controlplane', 'ncpc', input_param, wantlist=True) | dict2items | map(attribute='value') | map(attribute=getNisd) | map(attribute='Status') | list | first == "Dead"
       retries: 10
       delay: 1

     - name: "{{ recipe_name }}: Restart same nisd process."
       vars:
          input_param: {
                  'nisd_uuid' : '{{ nisdUUID.stdout }}',
                  'uport' : '1053',
                  'lookout_uuid' :  '{{ lookoutUUID["stdout_lines"][0] }}'
                  }
       debug:
         msg: "{{ lookup('controlplane', 'nisd', input_param, wantlist=True) }}"
       no_log: True

     - pause:
         seconds: 2

     - name: "{{ recipe_name }}: Wait until restarted nisd's status gets changed."
       vars:
         getNisd: "{{ nisdUUID.stdout }}"
         input_param: {
                  'Operation': 'NISDGossip',
                  'OutfileName': 'restarted_nisdGossip'
                  }
       debug:
         msg: "Verifying NISD's Status"
       until: lookup('controlplane', 'ncpc', input_param, wantlist=True) | dict2items | map(attribute='value') | map(attribute=getNisd) | map(attribute='Status') | list | first == "Alive"
       retries: 20
       delay: 1

     - name: "{{ recipe_name}}: Wait until nisd_root_entry gets updated"
       vars:
         stage: "wait_for_nisd_root_entry"
         process_type: "nisd"
         lookout_uuid: "{{ lookoutUUID['stdout_lines'][0] }}"
       debug:
         msg: "Waiting for nisd to get updated"
       until: lookup('niova_ctlrequest', 'lookup', nisdUUID.stdout, "/nisd_root_entry/0/status", 'nisd', lookout_uuid, wantlist=True) | dict2items | map(attribute='value') | list | first == "running"
       retries: 10
       delay: 1

     - name: "{{ recipe_name }}: Verify nisd_root_entry."
       vars:
         stage: "aftrRestart_nisd_info"
         old_num_block_used: "{{ aftrRestartNisd['results'][0]['item']['/0/num-pblks-used'] }}"
         process_type: "nisd"
         lookout_uuid: "{{ lookoutUUID['stdout_lines'][0] }}"
         aftrRestart: "{{ lookup('niova_ctlrequest', 'lookup', nisdUUID.stdout, nisd_root_keys, 'nisd', lookout_uuid, wantlist=True) }}"
       debug:
         msg: "Verify nisd_root_entry"
       no_log: True
       failed_when: >
         (aftrRestart['/0/uuid'] != nisdUUID.stdout) or
         (aftrRestart['/0/status'] != "running") or
         (aftrRestart['/0/vblks-written'] != 0) or
         (aftrRestart['/0/num-reserved-pblks-used'] != 1) or
         (aftrRestart['/0/num-pblks-used'] != ((old_num_block_used | int) + 50))

     - name: "{{ recipe_name }}: Verify nisd_chunks Checks"
       vars:
         stage: "aftrRestart_nisd_chunks"
         old_metablock: "{{ oldMetablockSeqNo['results'][0]['item']['/0/metablock-seqno'] }}"
         process_type: "nisd"
         lookout_uuid: "{{ lookoutUUID['stdout_lines'][0] }}"
         aftrRestart: "{{ lookup('niova_ctlrequest', 'lookup', nisdUUID.stdout, nisd_chunk_keys, 'nisd', lookout_uuid, wantlist=True) }}"
       debug:
         msg: "Verify nisd_chunks Checks: {{ old_metablock }}, {{ aftrRestart }}"
       no_log: True
       failed_when: >
         (aftrRestart['/0/vdev-uuid'] != vdevUUID.stdout) or
         (aftrRestart['/0/number'] != 0) or
         (aftrRestart['/0/num-data-pblks'] != 50) or
         (aftrRestart['/0/num-meta-pblks'] != 0) or
         (aftrRestart['/0/num-reserved-meta-pblks'] != 1) or
         (aftrRestart['/0/metablock-seqno'] != (old_metablock | int)) or
         (aftrRestart['/0/read-op-seqno'] != -1) or
         (aftrRestart['/0/merge-read-op-seqno'] != -1) or
         (aftrRestart['/0/chunk-merge-cnt'] != 0) or
         (aftrRestart['/0/chunk-merge-status'] != "idle")

     - name: "{{ recipe_name }}: Perform a Read of the Previously Written VBLKS."
       vars:
         input_param: {
                 'uuid_to_write' : 'unix:{{ nisdUUID.stdout }}',
                 'vdev' : '{{ vdevUUID.stdout }}',
                 'read_operation_ratio_percentage' : '100',
                 'random_seed' : '123',
                 'client_uuid' : '{{ blockTestClientUUID.stdout }}',
                 'request_size_in_bytes' : '32',
                 'queue_depth' : '1',
                 'num_ops' : '50',
                 'lookout_uuid' :  '{{ lookoutUUID["stdout_lines"][0] }}',
                 'integrity_check' : True,
                 'sequential_writes' : False
                 }
         rd_success: "{{ lookup('controlplane', 'niova-block-test', input_param, wantlist=True) }}"
       debug:
         msg: "get read's return code"
       with_items:
        - "{{ rd_success }}"
       register: get_rd

     - debug:
         msg: "Verify read must pass"
       failed_when: (get_rd['results'][0]['item'] != "0")

     - name: "Verify 'tasks' items are idle."
       include_role:
         name: common
         tasks_from: verify_nisd_tasks_parameters
       vars:
         NisdUUID: "{{ nisdUUID.stdout }}"
         LookoutUUID: "{{ lookoutUUID['stdout_lines'][0] }}"

     - name: "{{ recipe_name }}: Verify nisd_root_entry."
       vars:
         stage: "aftrRead_nisd_info"
         nisd_keys:
              - "/nisd_root_entry/0/vblks-read"
              - "/nisd_root_entry/0/vblks-hole-read"
         process_type: "nisd"
         lookout_uuid: "{{ lookoutUUID['stdout_lines'][0] }}"
         aftrRead: "{{ lookup('niova_ctlrequest', 'lookup', nisdUUID.stdout, nisd_keys, 'nisd', lookout_uuid, wantlist=True) }}"
       debug:
         msg: "Verify nisd_root_entry: {{ aftrRead }}"
       no_log: True
       failed_when: >
         (aftrRead['/0/vblks-read'] != 1600) or
         (aftrRead['/0/vblks-hole-read'] != 0)

     - name: "{{ recipe_name }}: Verify nisd_chunk checks."
       vars:
         stage: "aftrRead_nisd_chunk"
         process_type: "nisd"
         lookout_uuid: "{{ lookoutUUID['stdout_lines'][0] }}"
         aftrRead: "{{ lookup('niova_ctlrequest', 'lookup', nisdUUID.stdout, nisd_chunk_keys, 'nisd', lookout_uuid, wantlist=True) }}"
       debug:
         msg: "Verify nisd_chunks: {{ aftrRead }}"
       no_log: True
       failed_when: >
         (aftrRead['/0/vblks-read'] != 1600) or
         (aftrRead['/0/read-op-seqno'] != 49) or
         (aftrRead['/0/ref-cnt'] != ((aftrRead['/0/num-cme'] | int) + 1))

    rescue:
     - name: "Recipe: {{ recipe_name }} failed"
       set_fact:
         terminate_recipe: true









