- name: "get multiple leases"
  hosts: localhost
  connection: local
  vars:
     recipe_name: "get_multiple_leases"
     parent: None
     no_of_leases: 10

  tasks:
  - block:
    - name: "{{ recipe_name }}: Get the non-running peers list to select first peer to start"
      include_role:
        name: common
        tasks_from: get_server_uuid_info

    - name: "Start 5 peers in the cluster"
      include_role:
        name: common
        tasks_from: start_server
      vars:
        ServerUUID: "{{ NonRunningServers[item] }}"
      loop: "{{ range(0, NonRunningServers | length) | list }}"

    - name: "{{ recipe_name }}: Get the running peers list."
      include_role:
        name: common
        tasks_from: get_server_uuid_info
    
    - name: "Get multiple client uuids."
      include_role:
        name: common
        tasks_from: get_multiple_client_uuids
      loop: "{{ range(0, no_of_leases) | list }}"

    - name: "Get multiple resource uuids."
      include_role:
        name: common
        tasks_from: get_multiple_resource_uuids
      loop: "{{ range(0, no_of_leases) | list }}"
    
    - name: "Perform multiple 'get_lease' operation"
      include_role:
        name: common
        tasks_from: get_lease
      vars:
         ClientUUID: "{{ ClientUUIDS }}"
         resourceUUID: "{{ resourceUUIDS }}"
         outfilename: "{{ resourceUUIDS }}"
         no_of_lease_ops: "{{ no_of_leases }}"

    - name: "Perform multiple 'lookup_lease' operation"
      include_role:
        name: common
        tasks_from: lookup_lease
      vars:
         ClientUUID: '{{ ClientUUIDS }}'
         resourceUUID: '{{ resourceUUIDS }}'
         outfilename: '{{ resourceUUIDS }}'
         no_of_lease_ops: "{{ no_of_leases }}"

