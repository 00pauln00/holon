  - name: "{{ recipe_name }}: Wait until last-applied-cumulative-crc and sync-entry-crc values are same on all peers."
    vars:
      stage: "get_crc_val"
      crc_key:
        - "/raft_root_entry/0/last-applied-cumulative-crc"
        - "/raft_root_entry/0/sync-entry-crc"
    debug:
      msg: "{{ lookup('niova_ctlrequest', 'lookup', NRunningPeers, crc_key, wantlist=True) }}"
    loop: "{{ range(0, 30) | list }}"
    loop_control:
       pause: 1

  - set_fact:
       crc_on_all_peers: []

  - name: "{{ recipe_name }}: Get last-applied-cumulative-crc and sync-entry-crc."
    vars:
      stage: "verify_crc"
      raft_key:
          - "/raft_root_entry/0/last-applied-cumulative-crc"
          - "/raft_root_entry/0/sync-entry-crc"
    set_fact:
      crc_on_all_peers: "{{ lookup('niova_ctlrequest', 'lookup', NRunningPeers, raft_key, wantlist=True) }}"
    failed_when: >
         (crc_on_all_peers[itr]['/0/last-applied-cumulative-crc'] != crc_on_all_peers[itr + 1]['/0/last-applied-cumulative-crc']) or
         (crc_on_all_peers[itr]['/0/sync-entry-crc'] != crc_on_all_peers[itr + 1]['/0/sync-entry-crc'])
    loop: "{{ range(0, NRunningPeers | length - 1)| list }}"
    loop_control:
        loop_var: itr

