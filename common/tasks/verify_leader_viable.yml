
    - name: "{{ recipe_name }}: wait until leader is viable."
      vars:
        stage: "wait_until_leader_viable"
        raft_key:
            - "/raft_client_root_entry/0/leader-viable"
      debug:
       msg: "Wait until leader-vaible set to true"
      until: lookup('niova_ctlrequest', 'lookup', ClientUUID, raft_key, wantlist=True) | dict2items | map(attribute='value') | list | bool != True
      loop: "{{ range(0, 60) | list }}"
      loop_control:
        pause: 1

    - name: "{{ recipe_name }}: Validate leader-viable is 'true'."
      vars:
        stage: "getLeaderViable"
        raft_key:
            - "/raft_client_root_entry/0/leader-viable"
      set_fact:
        GetLeaderViable: "{{ lookup('niova_ctlrequest', 'lookup', ClientUUID, raft_key, wantlist=True) }}"
      failed_when: GetLeaderViable['/0/leader-viable'] != True




