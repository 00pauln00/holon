---

    - name: "Get the json path"
      set_fact:
        base_dir="{{ raft_conf | json_query('base_dir_path')}}"
        raft_uuid="{{ raft_conf | json_query('raft_uuid')}}"

    - name: "prepare path to read recipe JSON file"
      shell: cat "{{base_dir}}"/"{{raft_uuid}}".json
      register: result

    - name: "Convert output to JSON format"
      set_fact:
        jsondata: "{{ result.stdout | from_json }}"

    - name: "Get the running peer UUID(s) from recipe JSON"
      set_fact:
        nrunning_peers: "{{ jsondata | json_query(jmesquery) }}"
      vars:
        jmesquery: 'raft_process.*.process_uuid'

    - name: "Get the list of all peers"
      set_fact:
        total_peers_dict="{{ raft_conf | json_query('peer_uuid_dict')}}"
    - name: "Convert dictionary values into list"
      set_fact:
        total_peers_list="{{ total_peers_dict.values() | list }}"

    - name: "Print the lists"
      debug:
        msg:
         - "{{total_peers_list}}"
         - "{{nrunning_peers}}"
    - name: "Get the non-running peer list"
      set_fact:
       non_running_peers="{{ total_peers_list | difference(nrunning_peers)}}"

    - name: "Print non-running peers"
      debug:
       msg: "{{ non_running_peers}}"
